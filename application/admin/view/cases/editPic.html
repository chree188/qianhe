{extend name="pub/extend" /}

{block name="title"}
    <title>编辑案例图片</title>
{/block}

{block name="link"}
    <!--dynamic table-->
    <link href="__PUBLIC__/js/advanced-datatable/css/demo_page.css" rel="stylesheet" />
    <link href="__PUBLIC__/js/advanced-datatable/css/demo_table.css" rel="stylesheet" />
    <link rel="stylesheet" href="__PUBLIC__/js/data-tables/DT_bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/my.css" />

    <!--multi-select-->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/js/jquery-multi-select/css/multi-select.css" />

    <!--file upload-->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/bootstrap-fileupload.min.css" />

    <!--tags input-->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/js/jquery-tags-input/jquery.tagsinput.css" />
{/block}

{block name="bread"}
    <ul class="breadcrumb">
        <li>
            <a href="{:url('Index/index')}">首页</a>
        </li>
        <li>
            <a href="{:url('Cases/lst')}">案例中心</a>
        </li>
        <li class="active">编辑案例图片</li>
    </ul>
{/block}

{block name="content"}
    <div class="row">
        <div class="col-lg-12">
            <section class="panel">
                <header class="panel-heading">
                    编辑案例图片
                </header>
                <div class="panel-body">
                    <div class=" form">
                        <form class="cmxform form-horizontal adminex-form" id="commentForm" method="post" action="{:url('Cases/editPic',array('id' => $id))}" enctype="multipart/form-data">
                            <input type="hidden" name="cid" value="0"/>
                            {volist name="pic" id="vo"}
                            <div class="form-group" url="{$vo.pic}" onclick="ed({$vo.id},this)">
                                <a href="#myModal" data-toggle="modal"><img src="__IMAGE__/{$vo.pic}" title="点我编辑" width="50%"></a>
                            </div>
                            {/volist}
                            <div class="form-group">
                                <label class="control-label col-md-1">添加图片</label>
                                <div class="controls col-md-1" id="img">
                                    
                                </div>
                                <div class="col-lg-10 col-lg-offset-1">
                                    <a href="javascript:;" class="btn btn-success btn-xs" onclick="addimg()">添加更多图片</a>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-lg-offset-1 col-lg-11">
                                    <button class="btn btn-primary" type="submit">添加图片</button>
                                    <button class="btn btn-default" type="reset">重新添加</button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </section>
        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">编辑图片</h4>
                </div>

                <div class="modal-body row">
                    <div class="col-md-10 col-md-offset-1">
                        <form action="{:url('Cases/editPic',array('id' => $id))}" method="post" enctype="multipart/form-data">
                            <input type="hidden" name="cid" value="" id="cid" />
                            <div class="form-group last">
                                <label class="control-label">修改图片</label>
                                <div>
                                    <div class="fileupload fileupload-new" data-provides="fileupload">
                                        <div class="fileupload-new thumbnail" style="width: 200px; height: 150px;">
                                            <img src="http://www.placehold.it/200x150/EFEFEF/AAAAAA&amp;text=no+image" id="i" alt="">
                                        </div>
                                        <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 200px; max-height: 150px; line-height: 20px;"></div>
                                        <div>
                                               <span class="btn btn-default btn-file">
                                               <span class="fileupload-new"><i class="fa fa-paper-clip"></i>图片添加</span>
                                               <span class="fileupload-exists"><i class="fa fa-undo"></i> 修改</span>
                                               <input type="file" name="pic[]" class="default">
                                               </span>
                                            <a href="#" class="btn btn-danger fileupload-exists" data-dismiss="fileupload"><i class="fa fa-trash"></i>移除</a>
                                        </div>
                                    </div>
                                    <br>
                                </div>
                            </div>
                            <div class="pull-right">
                               <button class="btn btn-success btn-sm" type="submit">保存更改</button>
                               <a href="" class="btn btn-danger btn-sm" id="del">删除图片</a>
                            </div>
                        </form>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <!-- modal -->
{/block}

{block name="js"}
    <!--dynamic table-->
    <script type="text/javascript" language="javascript" src="__PUBLIC__/js/advanced-datatable/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/data-tables/DT_bootstrap.js"></script>
    <!--dynamic table initialization -->
    <!-- <script src="__PUBLIC__/js/dynamic_table_init.js"></script> -->

    <!--icheck -->
    <script src="__PUBLIC__/js/iCheck/jquery.icheck.js"></script>
    <script src="__PUBLIC__/js/icheck-init.js"></script>
    <!--multi-select-->
    <script type="text/javascript" src="__PUBLIC__/js/jquery-multi-select/js/jquery.multi-select.js"></script>
    <script type="text/javascript" src="__PUBLIC__/js/jquery-multi-select/js/jquery.quicksearch.js"></script>
    <script src="__PUBLIC__/js/multi-select-init.js"></script>
    <!--spinner-->
    <script type="text/javascript" src="__PUBLIC__/js/fuelux/js/spinner.min.js"></script>
    <script src="__PUBLIC__/js/spinner-init.js"></script>
    <!--file upload-->
    <script type="text/javascript" src="__PUBLIC__/js/bootstrap-fileupload.min.js"></script>
    <!--tags input-->
    <script src="__PUBLIC__/js/jquery-tags-input/jquery.tagsinput.js"></script>
    <script src="__PUBLIC__/js/tagsinput-init.js"></script>
    <!--bootstrap input mask-->
    <script type="text/javascript" src="__PUBLIC__/js/bootstrap-inputmask/bootstrap-inputmask.min.js"></script>

    <script type="text/javascript">
        //图片添加更多
        function addimg(){
            $('#img').append("<div class='fileupload fileupload-new' data-provides='fileupload'><span class='btn btn-default btn-file'><span class='fileupload-new'><i class='fa fa-paper-clip'></i> 添加图片</span><span class='fileupload-exists'><i class='fa fa-undo'></i> 修改</span><input type='file' name='pic[]' class='default' /></span><span class='fileupload-preview' style='margin-left:5px;'></span><a href='#' class='close fileupload-exists' data-dismiss='fileupload' style='float: none; margin-left:5px;'></a></div><br>");
        }

        //填充编辑表单数据
        function ed(cid,obj){
            var url = $(obj).attr('url');
            console.log(url);
            $('#cid').val(cid);
            $('#i').attr('src','__IMAGE__/'+url);
            $('#del').attr('href',"{:url('Cases/delImg')}?id="+cid);
        }
    </script>
{/block}